@using Microsoft.AspNetCore.Identity
@using FinancePortal.Services
@using FinancePortal.Enums
@model FinancePortal.Models.Household

@inject IImageService ImageService
@inject UserManager<FPUser> userManager


@{
    ViewData["Title"] = "Welcome to Your Dashboard";
}

<h1>@ViewData["Title"]</h1>

<div>
    <div>
        <h4>Money Tracker</h4>
        <div class="row">
            <div class="col-4">
                <ul>
                    <li class="nav-item">
                        <a class="nav-link btn btn-success" asp-controller="Households" asp-action="Dashboard">Household Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link btn btn-success" asp-controller="HouseholdBankAccounts" asp-action="Create">Create Bank Accounts</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link btn btn-success" asp-controller="HouseholdCategories" asp-action="Create">Create a Category</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link btn btn-success" asp-controller="CategoryItems" asp-action="Create">Create a Category Item</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link btn btn-success" asp-controller="Transactions" asp-action="Create">Budget Item Mgmt.</a>
                    </li>

                    @if (User.IsInRole("MEMBER") || User.IsInRole("HEAD") && Model.Occupants.Count == 1)
                    {
                        <li class="nav-item">
                            <a class="nav-link btn btn-danger" asp-controller="Households" asp-action="Dashboard">Household Dashboard</a>
                        </li>

                    }

                </ul>

            </div>
            <div class="col-8">
                <div class="row">
                    <h5>Welcome to my House</h5>
                </div>
                <div class="row">
                    <h3>Household Occupants</h3>
                    <form class="form-inline" asp-controller="HouseholdInvitations" asp-action="Create">
                        <label for="First Name" class="mr-md-2">FirstName:</label>
                        <input type="text" class="form-control mb-2 mr-md-2" placeholder="First Name">
                        <label for="Last Name" class="mr-md-2">LastName:</label>
                        <input type="text" class="form-control mb-2 mr-md-2" placeholder="Last Name">
                        <label for="email" class="mr-md-2">Email address:</label>
                        <input type="email" class="form-control mb-2 mr-md-2" placeholder="Enter email" id="email">
                        <label for="text" class="mr-md-2">Role:</label>
                        <input type="text" class="form-control mb-2 mr-md-2" placeholder="Head">
                        <div class="form-check mb-2 mr-md-2">
                            <label class="form-label">Invite Members</label>
                        </div>
                        <tboby>
                            @foreach (var member in Model.Occupants.ToList())
                            {
                                var role = (await userManager.GetRolesAsync(member)).FirstOrDefault();
                                <tr>
                                    <td> @member.FirstName</td>
                                    <td> @member.LastName</td>
                                    <td> @member.Email</td>
                                    <td> @role</td>
                                    <td>
                                        @if (role == HouseholdRole.HEAD.ToString())
                                        {
                                            <button type="submit"  value="Create" class="btn btn-primary mb-2">Send Invitation</button>
                                        }

                                    </td>
                                </tr>
                            }
                        </tboby>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!------------------------------>
<!-- Button to Open the Modal -->
<!------------------------------>
<button type="button" class="btn btn-success" data-toggle="modal" data-target="#myModal">
    Create Invititation
</button>

<!--------------->
<!-- The Modal -->
<!--------------->
<div class="modal" id="myModal">
    <div class="modal-dialog-centered modal-dialog modal-xl">
        <div class="modal-content">
            <!------------------>
            <!-- Modal Header -->
            <!------------------>
            <div class="modal-header justify-content-center bg-success">
                <h4 class="modal-title text-white">Invitation to Join</h4>
            </div>
            <!---------------->
            <!-- Modal body -->
            <!---------------->
            <div class="modal-body bg-light justify-content-center">
                <form id="frmInvite" asp-controller="HouseholdInvitations" asp-action="Create">
                    @Html.AntiForgeryToken()
                    @*@Html.Hidden("HouseholdId", Model.Id)*@
                    <input type="hidden" name="HouseholdId" value="@Model.Id" />
                    <div class="container-fluid">
                        <div class="row">
                            <div class="col">
                                <div class="input-group mb-6">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text">First Name</span>
                                    </div>
                                    <input name="FirstName" id="FirstName" type="text" class="form-control" />
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col">
                        <div class="input-group mb-6">
                            <div class="input-group-prepend">
                                <span class="input-group-text">Last Name</span>
                            </div>
                            <input name="LastName" id="LastName" type="text" class="form-control" />
                        </div>
                    </div>
                    <br />
                    <div class="col">
                        <div class="input-group mb-6">
                            <div class="input-group-prepend">
                                <span class="input-group-text">Email</span>
                            </div>
                            <input name="EmailTo" id="Recipient" type="email" class="form-control" />
                        </div>
                    </div>
                    <br />
                    <div class="col">
                        <div class="input-group mb-6">
                            <div class="input-group-prepend">
                                <span class="input-group-text">Subject</span>
                            </div>
                            <input name="Subject" id="Subject" type="text" class="form-control" />
                        </div>
                    </div>
                    <br />
                    <div class="col">
                        <div class="input-group mb-6">
                            <div class="input-group-prepend">
                                <span class="input-group-text">Message</span>
                            </div>
                            <input name="Message" id="Message" type="text" class="form-control" />
                        </div>
                    </div>
                    <br />
                    <div class="col">
                        <div class="input-group mb-6">
                            <div class="input-group-prepend">
                                <span class="input-group-text">Expires</span>
                            </div>
                            <input name="Expires" id="Expires" type="text" class="form-control" />
                        </div>
                    </div>
                    <br />
                    <div class="col">
                        <div class="input-group mb-6">
                            <div class="input-group-prepend">
                                <span class="input-group-text">Role</span>
                            </div>
                            <input name="Role" id="Role" type="text" class="form-control" />
                        </div>
                    </div>
                    <button id="btnSend" type="submit" class="btn btn-success">Send</button>
                </form>
            </div>
            <!------------------>
            <!-- Modal footer -->
            <!------------------>

            <div class="modal-footer bg-light">

                <button id="btnReset" type="button" class="btn btn-outline-success" data-dismiss="modal">Close</button>
            </div>

        </div>
    </div>
</div>

<script src="~/js/libscripts.bundle.js"></script>


@section scripts {
    <script>
        $("btnSend").on("click", function () {
            $("frmInvite").submit();
            $("invite").modal('hide');
            $("#btnReset").click();
        });
    </script>

}
